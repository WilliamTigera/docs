---
description: Scan images in container registeries.
---

# Scan images in container registries

Scan images in container registries at any time, on any infrastructure, including Kubernetes.

## Value

Add a layer of defense for images that don’t go through a pipeline (for example, third-party images), but are published to registries. If CVEs are missed in your build pipeline, you can catch them before they are deployed.

## Concepts

You can deploy the registry scanner wherever you want. Locally on a laptop. Anywhere. And it doesn’t have to be for Kubernetes.

To use this option, all you need to do is:
- Specify the registry paths to the images you want to scan
- Provide permissions for the scanner to access your registries
- Get a token for access to the Image Assurance API

Based on the paths you specify, the scanner recursively scans all images in the registry once, and sends results to the Image Assurance dashboard in Manager UI. Because the scanner is not running continuously, it may take some time for results to display in the dashboard, especially if you have many images or large images.

## Before you begin

**Required**

- You must have valid registry credentials

**Supported registry platforms**

- Amazon ECR
- Azure Container Registry
- Google GCR 

**Limitations**

- The registry scanner is available as an image (not using Tigera operator installation)
- You can scan images from only one of the supported registry platforms/account per instance

## How to

- [Download the registry scanner](#download-the-registry-scanner)
- [Set up registry scanner](#set-up-registry-credentials)
- [Scan images and send results to Calico Cloud](#scan-images-and-send-results-calico-cloud)
- [Troubleshoot](#troubleshoot)
- [Get registry scanner updates](#get-registry-scanner-updates)

### Download the registry scanner

The registry scanner comes in a docker image. To get the image, run `docker pull quay.io/tigera/image-assurance-registry-scanner:v1.10.4`.

### Set up registry scanner

#### Credentials

The registry scanner supports scanning all registries as long as the docker credentials are provided.
Providing the `DOCKER_USERNAME` and `DOCKER_PASSWORD` lets the registry scanner retrieve images that the credentials have access to. Retrieving images 
using these credentials will only retrieve images with tags.

If you have a valid /.docker/config.json, you can also mount these while running the registry scanner.
```
docker run -v ~/.docker/config.json:/.docker/config.json quay.io/tigera/image-assurance-registry-scanner:v1.10.4
```

The registry scanner also supports authentication using AZURE and AWS credentials. If you use these credentials, the registry scanner is able to
retrieve images with no tags associated with them.

Azure credentials needed:
`AZURE_CLIENT_ID` 
`AZURE_CLIENT_SECRET` or `AZURE_FEDERATED_TOKEN`
`AZURE_TENANT_ID`

AWS credentials needed:
`AWS_ACCESS_KEY_ID`
`AWS_SECRET_ACCESS_KEY`
`AWS_REGION`

The registry scanner currently scans one registry at a time. If you specify the Azure or AWS credentials, the docker username and password will not be used.

#### Required Inputs

The registry scanner requires:
 
`REGISTRY` - the registry you want to scan.
`IMAGE_ASSURANCE_API_URL` - You can get this URL in the manager UI.
`IMAGE_ASSURANCE_API_TOKEN` - You can get this token in the manager UI. 
Either the `DOCKER_USERNAME` and `DOCKER_PASSWORD`, Azure credentials, or AWS credentials. 

#### Optional Inputs 

`REGISTRY_FILTER` - with thousands of repositories and images, sometimes we do not want to scan everything as it could be very time consuming.
This environment variable supports a comma separated list on what you want to scan.

Example: for a gcr registry that contains:
```
gcr.io/prod-env/api
gcr.io/staging-env/api 
gcr.io/dev/api
```
You might not care about the dev "sub" registry. Simply provide 1-e REGISTRY_FILTER=prod-env,staging-env` to filter out the images under dev.

### Scan images and send results to Calico Cloud

Example run for a gcr registry with Docker Username and Password:

```
docker run -e REGISTRY=gcr.io -e IMAGE_ASSURANCE_API_URL=https://<clustId>-management.dev.calicocloud.io/bast
 -e IMAGE_ASSURANCE_API_TOKEN=$TOKEN -e DOCKER_USERNAME=<username> -e DOCKER_PASSWORD=<password>
 quay.io/tigera/image-assurance-registry-scanner:v1.10.4
```

Example run for an acr registry with Azure credentials:

```
docker run -e REGISTRY=your-org.azurecr.io -e IMAGE_ASSURANCE_API_URL=https://<clustId>-management.dev.calicocloud.io/bast
 -e IMAGE_ASSURANCE_API_TOKEN=$TOKEN -e AZURE_CLIENT_ID=<azure-client-id> -e AZURE_CLIENT_SECRET=<azure-client-secret> -e AZURE_TENANT_ID=<azure-tenant-id>
 quay.io/tigera/image-assurance-registry-scanner:v1.10.4
```

Example run for an ecr registry with AWS credentials:

```
docker run -e REGISTRY=gcr.io -e IMAGE_ASSURANCE_API_URL=https://<clustId>-management.dev.calicocloud.io/bast
 -e IMAGE_ASSURANCE_API_TOKEN=$TOKEN -e AWS_ACCESS_KEY_ID=<aws-access-key> -e AWS_SECRET_ACCESS_KEY=<aws-secret-access-key> -e AWS_REGION=<aws-region>
 quay.io/tigera/image-assurance-registry-scanner:v1.10.4
```

Example run when mounting the dockerfile:

```
docker run -e REGISTRY=gcr.io -e IMAGE_ASSURANCE_API_URL=https://<clustId>-management.dev.calicocloud.io/bast
 -e IMAGE_ASSURANCE_API_TOKEN=$TOKEN -v ~/.docker/config.json/:/.docker/config.json quay.io/tigera/image-assurance-registry-scanner:v1.10.4
```

### Troubleshoot

If you have troubles authenticating with the registry, check that the registry credentials are correct.
If you have trouble uploading the results to the calico cloud database, check that the api token and url are correct.

### Get registry scanner updates

Check our quay.io/tigera repository for the latest registry scanner versions.

## Next step

[Understand scan results in Manager UI](../understanding-scan-sresults)